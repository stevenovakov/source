Executive Summary
=================

The project sponsors at the *Child and Family Research Institute* (CFRI) use *Diffusion MRI* (dMRI/DTI) techniques to take low-cost, fast, accurate, and most importantly: non-intrusive images of the brain, in order to detect and diagnose conditions in patients.  With respect to feature size, the images produced by this technique are currently quite low resolution, on the order of millimeters, whereas the size of a neural connection (ie. an axon) is on the order of microns. Though diffusion-less MRI data is useful in medical diagnosis, the dMRI data can yield some surprising insights into neuron fiber dynamics, among other things. One extremely useful analysis method for processing neural dMRI data is probabilistic tractography (PT), which effectively resolves large-structure neuron fiber paths between brain regions. With existing software, and on a reasonably priced, non-cluster workstation, producing usable data can take up to one or more days of computation time. The two key processes of PT are *Local Parameter Estimation*, and *Global Connectivity Estimation*.

There exist devices onboard most workstations which are well suited to these sorts of computations.  A modern *Graphics Processing Unit* (GPU) is a cheap, off-the-shelf, widely available solution.  Modern GPU devices, though optimized for computer graphics, can offer a processing power of several trillion floating-point operations per second, and a memory bandwidth in the hundreds of gigabits per second. On the software end, an open-source medical software development team has already created an analysis toolkit called FSL (FMRIB Software Library), which has fully working CPU-based versions (in C++) of both Local Parameter Estimation and Global Connectivity Estimation called bedpostx and *probtrackx*, respectively. The sponsor has already developed a GPU solution to improve the Local Parameter Estimation stage.  They have also purchased a workstation with four NVIDIA Tesla series GPUs.  Their expectation for our project is to produce a working port of the Global Connectivity Estimation module and integrate it with their existing port for additional performance improvement. Our task, specifically, is to re-architect FSL's *probtrackx* into a SIMD pipeline to function on a multi-GPU workstation.

The solution we present is called *oclptx*, which is an OpenCL implementation of *probtrackx*. This package fits as a separate module within the FSL framework. We introduce a custom data management system that interacts with the existing FSL data loading code. The user passes in BedpostX data, mask data, and other options via the command line, and our system parses this data into GPU-compatible data containers. The particle starting data is dropped into a FIFO stack and processed by independent gpu manager threads (one for each GPU device). Depending on user specified options, some method of probabilistic interpolation is performed and, at the very least, the particles contribute to a global path pdf, which is exported for analysis.

Currently, though the code executes consistently well on our personal workstations, it does not function consistently on CFRI's hardware. To properly evaluate higher resolution DTI data, the CFRI workstation *must* be used, as our GPU hardware is lacking in sufficient VRAM. Currently, we are prepared to support ongoing debugging and validation until the Sponsor is satisfied with the quality of their implementation. The sponsor has agreed to help wherever possible, in order to facilitate faster completion.
